@layer composition {

  /* ===== allow container queries on body ===== */
  body {
      container-type: inline-size;
      container-name: viewport;
    }
  /* ===== FLOW ===== */
  .flow > * + * { margin-block-start: var(--space-4); }
  
  /* ===== GRID PRIMITIVE ===== */

  
  [class*="--make-grid"] {
    display: grid;
    gap: var(--space-2);
  }

  [class*="--make-grid"][class*=":fullpage"] {
    grid-template: auto 1fr auto / auto 1fr auto;
    height: 100svh;
  }

  body:has([class*=":fullpage"]) {
    margin: 0;
    overflow: hidden;
    overscroll-behavior: none;
  }

  [class*="--make-grid"][class*=":auto-fit"] {
    grid-template-columns: repeat(auto-fit, minmax(min(var(--min-col, 20ch), 100%), 1fr));
  }
  
  [class*="--make-grid"][class*=":auto-fill"] {
    grid-template-columns: repeat(auto-fill, minmax(min(var(--min-col, 20ch), 100%), 1fr));
  }
  
  [class*="--make-grid"][class*=":lcr"] {
    grid-template-columns: minmax(0, 1fr) auto minmax(0, 1fr);
  }
  [class*="--make-grid"][class*=":lcr"] > :nth-child(1) { justify-self: start; }
  [class*="--make-grid"][class*=":lcr"] > :nth-child(2) { justify-self: center; }
  [class*="--make-grid"][class*=":lcr"] > :nth-child(3) { justify-self: end; }
  
  [class*="--make-grid"][class*=":tmb"] {
    grid-template-rows: minmax(0, 1fr) auto minmax(0, 1fr);
  }
  [class*="--make-grid"][class*=":tmb"] > :nth-child(1) { align-self: start; }
  [class*="--make-grid"][class*=":tmb"] > :nth-child(2) { align-self: center; }
  [class*="--make-grid"][class*=":tmb"] > :nth-child(3) { align-self: end; }
  
  [class*="--make-grid"][class*=":overlap"] {
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
  }
  [class*="--make-grid"][class*=":overlap"] > * { grid-area: 1 / 1; }
  
  [class*="--make-grid"][class*=":dense"] { grid-auto-flow: dense; }
  [class*="--make-grid"] > [class*="--make-span"] { grid-column: 1 / -1; }
  
  [class*="--make-grid"][class*=":justify-start"] { justify-items: start; }
  [class*="--make-grid"][class*=":justify-center"] { justify-items: center; }
  [class*="--make-grid"][class*=":justify-end"] { justify-items: end; }
  [class*="--make-grid"][class*=":items-start"] { align-items: start; }
  [class*="--make-grid"][class*=":items-center"] { align-items: center; }
  [class*="--make-grid"][class*=":items-end"] { align-items: end; }
  [class*="--make-grid"][class*=":place-center"] { place-items: center; }
  
  /* ===== FLEX PRIMITIVE ===== */
  [class*="--make-flex"] {
    display: flex;
    gap: var(--space-2);
  }

  [class*="--make-flex"][class*=":stack"] { flex-direction: column; }
  [class*="--make-flex"][class*=":cluster"] { flex-direction: row; flex-wrap: wrap; }

  [class*="--make-flex"][class*=":flank:start"] > :first-child { flex-basis: var(--flank-size, auto); flex-grow: 1; }
  [class*="--make-flex"][class*=":flank:start"] > :last-child { flex-basis: 0; flex-grow: 999; min-inline-size: var(--content-min, 50%); }

  [class*="--make-flex"][class*=":flank:end"] > :last-child { flex-basis: var(--flank-size, auto); flex-grow: 1; }
  [class*="--make-flex"][class*=":flank:end"] > :first-child { flex-basis: 0; flex-grow: 999; min-inline-size: var(--content-min, 50%); }

  [class*="--make-flex"][class*=":spread"] { justify-content: space-between; }
  [class*="--make-flex"][class*=":center"] { justify-content: center; }
  [class*="--make-flex"][class*=":end"] { justify-content: flex-end; }
  [class*="--make-flex"][class*=":nowrap"] { flex-wrap: nowrap; }
  [class*="--make-flex"][class*=":items-center"] { align-items: center; }
  [class*="--make-flex"][class*=":items-start"] { align-items: start; }
  [class*="--make-flex"][class*=":items-end"] { align-items: end; }
  [class*="--make-flex"][class*=":items-baseline"] { align-items: baseline; }
}


@layer composition.viewtransitions {
  main { view-transition-name: main-panel; }
  ::view-transition-group(main-panel) { animation-duration: var(--duration-normal); animation-timing-function: var(--ease-out); }


  nav { view-transition-name: nav-panel; }
  ::view-transition-old(nav-panel) { animation: slide-out-left var(--duration-normal) var(--ease-out); }
  @keyframes slide-out-left { to { transform: translateX(-100%); } }
  ::view-transition-new(nav-panel) { animation: slide-in-left var(--duration-normal) var(--ease-out); }
  @keyframes slide-in-left { from { transform: translateX(-100%); } }

  aside { view-transition-name: aside-panel; }
  ::view-transition-old(aside-panel) { animation: slide-out-right var(--duration-normal) var(--ease-out); }
  ::view-transition-new(aside-panel) { animation: slide-in-right var(--duration-normal) var(--ease-out); }
  @keyframes slide-out-right { to { transform: translateX(100%); } }
  @keyframes slide-in-right { from { transform: translateX(100%); } }

}
