@layer composition {
  /* ===== CONTAINER SETUP ===== */
  body {
    container-type: inline-size;
    container-name: viewport;
  }

  /* ===== FLOW: Consistent vertical rhythm ===== */
  .flow > * + * {
    margin-block-start: var(--flow-space, var(--space-md));
  }

  /* ===== STACK: Vertical flex layout ===== */
  .stack {
    display: flex;
    flex-direction: column;
    gap: var(--stack-space, var(--space-md));
  }

  /* ===== CLUSTER: Horizontal wrapping flex layout ===== */
  .cluster {
    display: flex;
    flex-wrap: wrap;
    gap: var(--cluster-space, var(--space-md));
  }

  /* ===== SIDEBAR: Flex layout with fixed sidebar ===== */
  .sidebar {
    display: flex;
    flex-wrap: wrap;
    gap: var(--sidebar-space, var(--space-md));
  }

  .sidebar > :first-child {
    flex-basis: var(--sidebar-width, 250px);
    flex-grow: 1;
  }

  .sidebar > :last-child {
    flex-basis: 0;
    flex-grow: 999;
    min-inline-size: var(--sidebar-content-min, 50%);
  }

  /* Sidebar on right variant */
  .sidebar[data-direction="end"] > :last-child {
    flex-basis: var(--sidebar-width, 250px);
    flex-grow: 1;
  }

  .sidebar[data-direction="end"] > :first-child {
    flex-basis: 0;
    flex-grow: 999;
    min-inline-size: var(--sidebar-content-min, 50%);
  }

  /* ===== SWITCHER: Flex that switches to stack below threshold ===== */
  .switcher {
    display: flex;
    flex-wrap: wrap;
    gap: var(--switcher-space, var(--space-md));
  }

  .switcher > * {
    flex-grow: 1;
    flex-basis: calc((var(--switcher-threshold, 30rem) - 100%) * 999);
  }

  /* ===== GRID: Base grid system ===== */
  .grid {
    display: grid;
    gap: var(--grid-space, var(--space-md));
  }

  /* Auto-fit: fills available space */
  .grid[data-layout="auto-fit"] {
    grid-template-columns: repeat(
      auto-fit,
      minmax(min(var(--grid-min, 20ch), 100%), 1fr)
    );
  }

  /* Auto-fill: creates empty tracks */
  .grid[data-layout="auto-fill"] {
    grid-template-columns: repeat(
      auto-fill,
      minmax(min(var(--grid-min, 20ch), 100%), 1fr)
    );
  }

  /* LCR: Left-Center-Right */
  .grid[data-layout="lcr"] {
    grid-template-columns: minmax(0, 1fr) auto minmax(0, 1fr);
  }

  .grid[data-layout="lcr"] > :nth-child(1) {
    justify-self: start;
  }

  .grid[data-layout="lcr"] > :nth-child(2) {
    justify-self: center;
  }

  .grid[data-layout="lcr"] > :nth-child(3) {
    justify-self: end;
  }

  /* TMB: Top-Middle-Bottom */
  .grid[data-layout="tmb"] {
    grid-template-rows: minmax(0, 1fr) auto minmax(0, 1fr);
  }

  .grid[data-layout="tmb"] > :nth-child(1) {
    align-self: start;
  }

  .grid[data-layout="tmb"] > :nth-child(2) {
    align-self: center;
  }

  .grid[data-layout="tmb"] > :nth-child(3) {
    align-self: end;
  }

  /* Overlap: Stack elements in same grid cell */
  .grid[data-layout="overlap"] {
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
  }

  .grid[data-layout="overlap"] > * {
    grid-area: 1 / 1;
  }

  /* Fullpage: Holy grail layout */
  .grid[data-layout="fullpage"] {
    grid-template: auto 1fr auto / auto 1fr auto;
    min-height: 100svh;
  }

  body:has(.grid[data-layout="fullpage"]) {
    margin: 0;
    overflow: hidden;
    overscroll-behavior: none;
  }

  /* Dense packing */
  .grid[data-flow="dense"] {
    grid-auto-flow: dense;
  }

  /* ===== WRAPPER: Centered max-width container ===== */
  .wrapper {
    max-inline-size: var(--wrapper-max, 75rem);
    margin-inline: auto;
    padding-inline: var(--wrapper-padding, var(--space-md));
  }

  /* ===== REGION: Full-width section with internal wrapper ===== */
  .region {
    padding-block: var(--region-space, var(--space-lg));
  }

  .region > .wrapper {
    max-inline-size: var(--region-max, 75rem);
  }

  /* ===== COVER: Vertically center content in viewport ===== */
  .cover {
    display: flex;
    flex-direction: column;
    min-block-size: var(--cover-height, 100svh);
    padding: var(--cover-space, var(--space-md));
  }

  .cover > * {
    margin-block: var(--cover-space, var(--space-md));
  }

  .cover > :first-child:not(.cover__centered) {
    margin-block-start: 0;
  }

  .cover > :last-child:not(.cover__centered) {
    margin-block-end: 0;
  }

  .cover > .cover__centered {
    margin-block: auto;
  }

  /* ===== SPAN: Full-width grid child ===== */
  .span {
    grid-column: 1 / -1;
  }
}
